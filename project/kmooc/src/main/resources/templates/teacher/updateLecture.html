<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{teacher/common/header :: head}">
    <style>
        .content-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: contain;
        }

        .section-card {
            margin-bottom: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
        }

        .section-header {
            padding: 1rem;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .section-content {
            padding: 1rem;
        }

        .content-item {
            border: 1px solid #e9ecef;
            border-radius: 0.25rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .quiz-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>

<body>
    <nav th:replace="~{teacher/common/nav :: nav}"></nav>
    <div class="container mt-5">
        <h2>ê°•ì¢Œ ìˆ˜ì •</h2>
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">ê°•ì¢Œ ì •ë³´</h3>
                <button class="btn btn-primary btn-sm" onclick="updateCourseInfo()">ê°•ì¢Œ ì •ë³´ ì €ì¥</button>
            </div>
            <div class="card-body">
                <form id="courseUpdateForm">
                    <div class="mb-3">
                        <label class="form-label">ê°•ì¢Œ ì œëª©</label>
                        <input type="text" class="form-control" name="title" th:value="${course.title}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ê°•ì¢Œ ì„¤ëª…</label>
                        <textarea class="form-control" name="description" rows="3"
                            th:text="${course.description}"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">ê³¼ëª©</label>
                            <select class="form-control" name="subjectId" th:value="${course.subjectId}">
                                <option th:each="subject : ${subjects}" th:value="${subject.subjectId}"
                                    th:text="${subject.subjectName}"
                                    th:selected="${subject.subjectId == course.subjectId}">
                                </option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">ì–¸ì–´</label>
                            <select class="form-control" name="language">
                                <option value="KOREAN" th:selected="${course.language == 'KOREAN'}">í•œêµ­ì–´</option>
                                <option value="ENGLISH" th:selected="${course.language == 'ENGLISH'}">ì˜ì–´</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">ì£¼ì°¨</label>
                            <input type="number" class="form-control" name="weeks" th:value="${course.weeks}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">í•™ìŠµì‹œê°„(ë¶„)</label>
                            <input type="number" class="form-control" name="learningTime"
                                th:value="${course.learningTime}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">í•™ì ì€í–‰ì œ</label>
                            <select class="form-control" name="isCreditBank">
                                <option value="1" th:selected="${course.isCreditBank == 1}">ì˜ˆ</option>
                                <option value="0" th:selected="${course.isCreditBank == 0}">ì•„ë‹ˆì˜¤</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ì¸ë„¤ì¼</label>
                        <input type="file" class="form-control" name="thumbnail" accept="image/*">
                        <div class="mt-2" th:if="${course.thumbnail}">
                            <img th:src="${course.thumbnail}" class="img-thumbnail" style="max-width: 200px;">
                        </div>
                    </div>
                </form>
            </div>
            <br/>
            
            <!-- ì„¹ì…˜ ë° ì½˜í…ì¸  ëª©ë¡ -->
            <div class="accordion mb-4" id="lectureAccordion">
                <div th:if="${course.lectures != null}" th:each="lecture : ${course.lectures}" class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            th:data-bs-target="'#lecture' + ${lecture.lectureId}" aria-expanded="true">
                            <span class="lecture-title" th:text="${lecture.title}">ì„¹ì…˜ ì œëª©</span>
                            <input type="text" class="form-control d-none lecture-title-input"
                                th:value="${lecture.title}">
                        </button>
                    </h2>
                    <div th:id="'lecture' + ${lecture.lectureId}" class="accordion-collapse collapse show">
                        <div class="accordion-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="flex-grow-1">
                                    <p class="text-muted mb-0 lecture-description" th:text="${lecture.description}"
                                        th:data-lecture-id="${lecture.lectureId}"
                                        th:data-lecture-title="${lecture.title}"
                                        th:data-lecture-description="${lecture.description}">ì„¹ì…˜ ì„¤ëª…</p>
                                </div>
                                <div class="ms-3">
                                    <button class="btn btn-primary btn-sm me-2" th:onclick="'editSection(this)'">ì„¹ì…˜
                                        ìˆ˜ì •</button>
                                    <button class="btn btn-danger btn-sm"
                                        th:onclick="'deleteSection(' + ${lecture.lectureId} + ')'">ì‚­ì œ</button>
                                </div>
                            </div>
                            <!-- ì½˜í…ì¸  ëª©ë¡ -->
                            <div class="list-group">
                                <div th:each="content : ${lecture.contents}" class="list-group-item"
                                    th:data-content-id="${content.lectureContentId}">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="flex-grow-1">
                                            <h5 class="mb-1">
                                                <span th:if="${content.isVideo == 1}">ğŸ¥</span>
                                                <span th:if="${content.isVideo == 0}">ğŸ“„</span>
                                                <span class="content-title" th:text="${content.title}"></span>
                                                <input type="text" class="form-control d-none content-title-input"
                                                    th:value="${content.title}">
                                            </h5>
                                            <p class="mb-1 content-description" th:text="${content.description}"></p>
                                            <textarea class="form-control d-none content-description-input" rows="2"
                                                th:text="${content.description}"></textarea>

                                            <!-- íŒŒì¼ ìƒíƒœ í‘œì‹œ -->
                                            <div class="mt-2">
                                                <span th:if="${content.file != null}" class="text-muted">
                                                    í˜„ì¬ íŒŒì¼: <span th:text="${content.file?.fileName}"></span>
                                                </span>
                                                <span th:if="${content.file == null}" class="text-muted">
                                                    ë“±ë¡ëœ íŒŒì¼ ì—†ìŒ
                                                </span>
                                            </div>
                                            <input type="file" class="form-control d-none content-file-input"
                                                   th:name="'file_' + ${content.lectureContentId}"
                                                   accept="${content.type === 'video' ? 'video/*' : '*'}">
                                        </div>
                                        <div class="ms-3">
                                            <button class="btn btn-primary btn-sm me-2 edit-content-btn"
                                                th:onclick="'toggleContentEdit(this, ' + ${content.lectureContentId} + ')'">ìˆ˜ì •</button>
                                            <button class="btn btn-success btn-sm me-2 d-none save-content-btn"
                                                th:onclick="'saveContentEdit(this, ' + ${content.lectureContentId} + ')'">ì €ì¥</button>
                                            <button class="btn btn-danger btn-sm"
                                                th:onclick="'deleteContent(' + ${content.lectureContentId} + ')'">ì‚­ì œ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- í€´ì¦ˆ ì„¹ì…˜ -->
                            <div class="quiz-section mt-3" th:if="${lecture.quizzes != null && !lecture.quizzes.empty}">
                                <h5>í€´ì¦ˆ</h5>
                                <div class="list-group">
                                    <div th:each="quiz : ${lecture.quizzes}" class="list-group-item"
                                        th:data-quiz-id="${quiz.quizId}">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1 quiz-question" th:text="${quiz.question}">í€´ì¦ˆ ë¬¸ì œ</h6>
                                                <input type="text" class="form-control d-none quiz-question-input"
                                                    th:value="${quiz.question}">
                                                <p class="mb-1 quiz-answer" th:text="${quiz.answer}">í€´ì¦ˆ ë‹µì•ˆ</p>
                                                <input type="text" class="form-control d-none quiz-answer-input"
                                                    th:value="${quiz.answer}">
                                            </div>
                                            <div class="ms-3">
                                                <button class="btn btn-primary btn-sm me-2 edit-quiz-btn"
                                                    th:onclick="'toggleQuizEdit(this, ' + ${quiz.quizId} + ', ' + ${lecture.lectureId} + ')'">ìˆ˜ì •</button>
                                                <button class="btn btn-success btn-sm me-2 d-none save-quiz-btn"
                                                    th:onclick="'saveQuizEdit(this, ' + ${quiz.quizId} + ', ' + ${lecture.lectureId} + ')'">ì €ì¥</button>
                                                <button class="btn btn-danger btn-sm"
                                                    th:onclick="'deleteQuiz(' + ${quiz.quizId} + ')'">ì‚­ì œ</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ì½˜í…ì¸ /í€´ì¦ˆ ì—†ì„ ë•Œ ë©”ì‹œì§€ -->
                            <div th:if="${lecture.contents == null || lecture.contents.empty}"
                                class="text-center text-muted mt-3">
                                ë“±ë¡ëœ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.
                            </div>

                            <!-- ì¶”ê°€ ë²„íŠ¼ë“¤ -->
                            <div class="mt-3">
                                <button class="btn btn-success btn-sm me-2"
                                    th:onclick="'showAddContentForm(' + ${lecture.lectureId} + ')'">ì½˜í…ì¸  ì¶”ê°€</button>
                                <button class="btn btn-success btn-sm"
                                    th:onclick="'showAddQuizForm(' + ${lecture.lectureId} + ')'">í€´ì¦ˆ ì¶”ê°€</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="addSection()">ì„¹ì…˜ ì¶”ê°€</button>
            <button class="btn btn-danger" onclick="deleteLecture()">ê°•ì¢Œ ì‚­ì œ</button>
        </div>
    </div>
    <div class="modal fade" id="addSectionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ìƒˆ ì„¹ì…˜ ì¶”ê°€</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addSectionForm">
                        <div class="mb-3">
                            <label class="form-label">ì„¹ì…˜ ì œëª©</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ì„¹ì…˜ ì„¤ëª…</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="submitAddSection()">ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editSectionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ì„¹ì…˜ ìˆ˜ì •</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editSectionForm">
                        <input type="hidden" id="editSectionId">
                        <div class="mb-3">
                            <label class="form-label">ì„¹ì…˜ ì œëª©</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ì„¹ì…˜ ì„¤ëª…</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="submitEditSection()">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        // ê°•ì¢Œ ì •ë³´ ìˆ˜ì •
        async function updateCourseInfo() {
            const courseId = [[${ course.courseId }]];
            const form = document.getElementById('courseUpdateForm');
            const formData = new FormData(form);
            
            if (!formData.get('thumbnail').size) {
                formData.delete('thumbnail');
            }
            
            try {
                const response = await fetch(`/api/teacher/courses/${courseId}`, {
                    method: 'PUT',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ê°•ì¢Œ ì •ë³´ ìˆ˜ì • ì‹¤íŒ¨');
                }

                alert('ê°•ì¢Œ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || 'ê°•ì¢Œ ì •ë³´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì„¹ì…˜ ê´€ë ¨ í•¨ìˆ˜ë“¤
        async function addSection() {
            const courseId = [[${ course.courseId }]];
            try {
                const response = await fetch(`/api/teacher/courses/${courseId}/lectures`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: 'ìƒˆ ì„¹ì…˜',
                        description: 'ì„¹ì…˜ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”'
                    })
                });

                if (!response.ok) throw new Error('ì„¹ì…˜ ì¶”ê°€ ì‹¤íŒ¨');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ì„¹ì…˜ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        // ì„¹ì…˜ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        function editSection(button) {
            const container = button.closest('.accordion-body');
            const description = container.querySelector('.lecture-description');
            const lectureId = description.dataset.lectureId;
            const title = description.dataset.lectureTitle;
            const descriptionText = description.dataset.lectureDescription;

            const modal = new bootstrap.Modal(document.getElementById('editSectionModal'));
            document.getElementById('editSectionId').value = lectureId;
            document.querySelector('#editSectionForm [name="title"]').value = title;
            document.querySelector('#editSectionForm [name="description"]').value = descriptionText;
            modal.show();
        }

        // ì„¹ì…˜ ìˆ˜ì • ì œì¶œ
        async function submitEditSection() {
            const form = document.getElementById('editSectionForm');
            const lectureId = document.getElementById('editSectionId').value;
            const formData = new FormData(form);

            try {
                const response = await fetch(`/api/teacher/lectures/${lectureId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: formData.get('title'),
                        description: formData.get('description')
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ì„¹ì…˜ ìˆ˜ì • ì‹¤íŒ¨');
                }

                alert('ì„¹ì…˜ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || 'ì„¹ì…˜ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function deleteSection(lectureId) {
            if (!confirm('ì •ë§ ì´ ì„¹ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`/api/teacher/lectures/${lectureId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('ì„¹ì…˜ ì‚­ì œ ì‹¤íŒ¨');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ì„¹ì…˜ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function deleteContent(contentId) {
            if (!confirm('ì •ë§ ì´ ì½˜í…ì¸ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`/api/teacher/contents/${contentId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('ì½˜í…ì¸  ì‚­ì œ ì‹¤íŒ¨');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(`ì½˜í…ì¸  ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. : ${error.message}`);
            }
        }

        async function showAddContentForm(lectureId) {
            const contentList = document.querySelector(`#lecture${lectureId} .list-group`);
            const formHtml = `
        <div class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
                <div class="flex-grow-1">
                    <input type="text" class="form-control mb-2" name="title" required placeholder="ì½˜í…ì¸  ì œëª©">
                    <textarea class="form-control mb-2" name="description" rows="2" required placeholder="ì½˜í…ì¸  ì„¤ëª…"></textarea>
                    <select class="form-control mb-2" name="type" required>
                        <option value="video">ë™ì˜ìƒ</option>
                        <option value="file">ë¬¸ì„œ</option>
                    </select>
                    <input type="file" class="form-control" name="file" required>
                </div>
                <div class="ms-3">
                    <button class="btn btn-primary btn-sm mb-2" onclick="createContent(${lectureId}, this.closest('.list-group-item'))">ì €ì¥</button>
                    <button class="btn btn-secondary btn-sm" onclick="this.closest('.list-group-item').remove()">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    `;
            contentList.insertAdjacentHTML('beforeend', formHtml);
        }
        async function createContent(lectureId, formElement) {
            const formData = new FormData();
            formData.append('lectureId', lectureId);
            formData.append('title', formElement.querySelector('[name="title"]').value);
            formData.append('description', formElement.querySelector('[name="description"]').value);
            formData.append('type', formElement.querySelector('[name="type"]').value);
            formData.append('file', formElement.querySelector('[name="file"]').files[0]);
            try {
                const response = await fetch(`/api/teacher/lectures/${lectureId}/contents`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('ì½˜í…ì¸  ì¶”ê°€ ì‹¤íŒ¨');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ì½˜í…ì¸  ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        async function showAddQuizForm(lectureId) {
            const quizList = document.querySelector(`#lecture${lectureId} .quiz-list`);
            if (!quizList) {
                // í€´ì¦ˆ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìœ¼ë©´ ìƒì„±
                const accordionBody = document.querySelector(`#lecture${lectureId} .accordion-body`);
                const quizSection = document.createElement('div');
                quizSection.className = 'quiz-section mt-3';
                quizSection.innerHTML = '<h5>í€´ì¦ˆ</h5><div class="quiz-list"></div>';
                accordionBody.appendChild(quizSection);
            }

            const formHtml = `
        <div class="quiz-item card mb-2">
            <div class="card-body">
                <div class="mb-2">
                    <input type="text" class="form-control" name="question" placeholder="ë¬¸ì œ">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" name="answer" placeholder="ì •ë‹µ">
                </div>
                <div class="d-flex justify-content-end">
                    <button class="btn btn-primary btn-sm me-2" onclick="createQuiz(${lectureId}, this.closest('.quiz-item'))">ì €ì¥</button>
                    <button class="btn btn-secondary btn-sm" onclick="this.closest('.quiz-item').remove()">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    `;

            document.querySelector(`#lecture${lectureId} .quiz-list`).insertAdjacentHTML('beforeend', formHtml);
        }

        async function createQuiz(lectureId, quizItem) {
            const question = quizItem.querySelector('[name="question"]').value;
            const answer = quizItem.querySelector('[name="answer"]').value;

            if (!question || !answer) {
                alert('ë¬¸ì œì™€ ì •ë‹µì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`/api/teacher/lectures/${lectureId}/quizzes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        lectureId: lectureId,
                        quizzes: [{
                            question: question,
                            answer: answer
                        }]
                    })
                });

                if (!response.ok) throw new Error('í€´ì¦ˆ ì¶”ê°€ ì‹¤íŒ¨');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('í€´ì¦ˆ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        //í€´ì¦ˆ ì‚­ì œ
        async function deleteQuiz(quizId) {
            if (!confirm('ì •ë§ ì´ í€´ì¦ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`/api/teacher/quizzes/${quizId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('í€´ì¦ˆ ì‚­ì œ ì‹¤íŒ¨');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('í€´ì¦ˆ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì½˜í…ì¸  ìˆ˜ì • í† ê¸€
        function toggleContentEdit(btn, contentId) {
            const contentItem = btn.closest('[data-content-id]');
            const titleSpan = contentItem.querySelector('.content-title');
            const titleInput = contentItem.querySelector('.content-title-input');
            const descSpan = contentItem.querySelector('.content-description');
            const descInput = contentItem.querySelector('.content-description-input');
            const editBtn = contentItem.querySelector('.edit-content-btn');
            const saveBtn = contentItem.querySelector('.save-content-btn');
            const fileInput = contentItem.querySelector('.content-file-input');

            titleSpan.classList.toggle('d-none');
            titleInput.classList.toggle('d-none');
            descSpan.classList.toggle('d-none');
            descInput.classList.toggle('d-none');
            editBtn.classList.toggle('d-none');
            saveBtn.classList.toggle('d-none');
            fileInput.classList.toggle('d-none');
        }

        // ì½˜í…ì¸  ìˆ˜ì • ì €ì¥
        async function saveContentEdit(btn, contentId) {
            const contentItem = btn.closest('[data-content-id]');
            const formData = new FormData();
            formData.append('title', contentItem.querySelector('.content-title-input').value);
            formData.append('description', contentItem.querySelector('.content-description-input').value);
            const fileInput = contentItem.querySelector('.content-file-input');
            if (fileInput.files.length > 0) {
                formData.append('file', fileInput.files[0]);
            }
            try {
                const response = await fetch(`/api/teacher/contents/${contentId}`, {
                    method: 'PUT',
                    body: formData
                });

                if (!response.ok) throw new Error('ì½˜í…ì¸  ìˆ˜ì • ì‹¤íŒ¨');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ì½˜í…ì¸  ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í€´ì¦ˆ ìˆ˜ì • í† ê¸€
        function toggleQuizEdit(btn, quizId, lectureId) {
            const quizItem = btn.closest('[data-quiz-id]');
            const questionSpan = quizItem.querySelector('.quiz-question');
            const questionInput = quizItem.querySelector('.quiz-question-input');
            const answerSpan = quizItem.querySelector('.quiz-answer');
            const answerInput = quizItem.querySelector('.quiz-answer-input');
            const editBtn = quizItem.querySelector('.edit-quiz-btn');
            const saveBtn = quizItem.querySelector('.save-quiz-btn');

            questionSpan.classList.toggle('d-none');
            questionInput.classList.toggle('d-none');
            answerSpan.classList.toggle('d-none');
            answerInput.classList.toggle('d-none');
            editBtn.classList.toggle('d-none');
            saveBtn.classList.toggle('d-none');
        }

        // í€´ì¦ˆ ìˆ˜ì • ì €ì¥
        async function saveQuizEdit(btn, quizId, lectureId) {
            const quizItem = btn.closest('[data-quiz-id]');
            const quizData = {
                question: quizItem.querySelector('.quiz-question-input').value,
                answer: quizItem.querySelector('.quiz-answer-input').value
            };

            try {
                const response = await fetch(`/api/teacher/quizzes/${quizId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(quizData)
                });

                if (!response.ok) throw new Error('í€´ì¦ˆ ìˆ˜ì • ì‹¤íŒ¨');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(`í€´ì¦ˆ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. : ${error.message}`);
            }
        }

        // ì„¹ì…˜ ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸°
        function addSection() {
            new bootstrap.Modal(document.getElementById('addSectionModal')).show();
        }

        // ì„¹ì…˜ ì¶”ê°€ ì œì¶œ
        async function submitAddSection() {
            const courseId = [[${ course.courseId }]];
            const form = document.getElementById('addSectionForm');
            const formData = new FormData(form);

            try {
                const response = await fetch(`/api/teacher/courses/${courseId}/lectures`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: formData.get('title'),
                        description: formData.get('description')
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ì„¹ì…˜ ì¶”ê°€ ì‹¤íŒ¨');
                }

                alert('ì„¹ì…˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || 'ì„¹ì…˜ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        async function deleteLecture() {
            const courseId = [[${ course.courseId }]];
            if (!confirm('ì •ë§ ì´ ê°•ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                const response = await fetch(`/api/teacher/courses/${courseId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    alert('ê°•ì˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.href = '/teacher/myLectures';
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ê°•ì˜ ì‚­ì œ ì‹¤íŒ¨');
                }
            } catch (error) {
                alert(`ê°•ì˜ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. : ${error.message}`);
            }
        }
    </script>
    <footer th:replace="~{teacher/common/footer :: footer}"></footer>
</body>

</html>