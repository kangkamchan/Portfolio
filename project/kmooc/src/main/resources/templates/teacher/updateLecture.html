<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{teacher/common/header :: head}">
    <style>
        .content-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: contain;
        }

        .section-card {
            margin-bottom: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
        }

        .section-header {
            padding: 1rem;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .section-content {
            padding: 1rem;
        }

        .content-item {
            border: 1px solid #e9ecef;
            border-radius: 0.25rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .quiz-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>

<body>
    <nav th:replace="~{teacher/common/nav :: nav}"></nav>
    <div class="container mt-5">
        <h2>Í∞ïÏ¢å ÏàòÏ†ï</h2>
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">Í∞ïÏ¢å Ï†ïÎ≥¥</h3>
                <button class="btn btn-primary btn-sm" onclick="updateCourseInfo()">Í∞ïÏ¢å Ï†ïÎ≥¥ Ï†ÄÏû•</button>
            </div>
            <div class="card-body">
                <form id="courseUpdateForm">
                    <div class="mb-3">
                        <label class="form-label">Í∞ïÏ¢å Ï†úÎ™©</label>
                        <input type="text" class="form-control" name="title" th:value="${course.title}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Í∞ïÏ¢å ÏÑ§Î™Ö</label>
                        <textarea class="form-control" name="description" rows="3"
                            th:text="${course.description}"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Í≥ºÎ™©</label>
                            <select class="form-control" name="subjectId" th:value="${course.subjectId}">
                                <option th:each="subject : ${subjects}" th:value="${subject.subjectId}"
                                    th:text="${subject.subjectName}"
                                    th:selected="${subject.subjectId == course.subjectId}">
                                </option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ïñ∏Ïñ¥</label>
                            <select class="form-control" name="language">
                                <option value="KOREAN" th:selected="${course.language == 'KOREAN'}">ÌïúÍµ≠Ïñ¥</option>
                                <option value="ENGLISH" th:selected="${course.language == 'ENGLISH'}">ÏòÅÏñ¥</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Ï£ºÏ∞®</label>
                            <input type="number" class="form-control" name="weeks" th:value="${course.weeks}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">ÌïôÏäµÏãúÍ∞Ñ(Î∂Ñ)</label>
                            <input type="number" class="form-control" name="learningTime"
                                th:value="${course.learningTime}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">ÌïôÏ†êÏùÄÌñâÏ†ú</label>
                            <select class="form-control" name="isCreditBank">
                                <option value="1" th:selected="${course.isCreditBank == 1}">Ïòà</option>
                                <option value="0" th:selected="${course.isCreditBank == 0}">ÏïÑÎãàÏò§</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ïç∏ÎÑ§Ïùº</label>
                        <input type="file" class="form-control" name="thumbnail" accept="image/*">
                        <div class="mt-2" th:if="${course.thumbnail}">
                            <img th:src="${course.thumbnail}" class="img-thumbnail" style="max-width: 200px;">
                        </div>
                    </div>
                </form>
            </div>
            <br/>
            
            <!-- ÏÑπÏÖò Î∞è ÏΩòÌÖêÏ∏† Î™©Î°ù -->
            <div class="accordion mb-4" id="lectureAccordion">
                <div th:if="${course.lectures != null}" th:each="lecture : ${course.lectures}" class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            th:data-bs-target="'#lecture' + ${lecture.lectureId}" aria-expanded="true">
                            <span class="lecture-title" th:text="${lecture.title}">ÏÑπÏÖò Ï†úÎ™©</span>
                            <input type="text" class="form-control d-none lecture-title-input"
                                th:value="${lecture.title}">
                        </button>
                    </h2>
                    <div th:id="'lecture' + ${lecture.lectureId}" class="accordion-collapse collapse show">
                        <div class="accordion-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="flex-grow-1">
                                    <p class="text-muted mb-0 lecture-description" th:text="${lecture.description}"
                                        th:data-lecture-id="${lecture.lectureId}"
                                        th:data-lecture-title="${lecture.title}"
                                        th:data-lecture-description="${lecture.description}">ÏÑπÏÖò ÏÑ§Î™Ö</p>
                                </div>
                                <div class="ms-3">
                                    <button class="btn btn-primary btn-sm me-2" th:onclick="'editSection(this)'">ÏÑπÏÖò
                                        ÏàòÏ†ï</button>
                                    <button class="btn btn-danger btn-sm"
                                        th:onclick="'deleteSection(' + ${lecture.lectureId} + ')'">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                            <!-- ÏΩòÌÖêÏ∏† Î™©Î°ù -->
                            <div class="list-group">
                                <div th:each="content : ${lecture.contents}" class="list-group-item"
                                    th:data-content-id="${content.lectureContentId}">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="flex-grow-1">
                                            <h5 class="mb-1">
                                                <span th:if="${content.isVideo == 1}">üé•</span>
                                                <span th:if="${content.isVideo == 0}">üìÑ</span>
                                                <span class="content-title" th:text="${content.title}"></span>
                                                <input type="text" class="form-control d-none content-title-input"
                                                    th:value="${content.title}">
                                            </h5>
                                            <p class="mb-1 content-description" th:text="${content.description}"></p>
                                            <textarea class="form-control d-none content-description-input" rows="2"
                                                th:text="${content.description}"></textarea>

                                            <!-- ÌååÏùº ÏÉÅÌÉú ÌëúÏãú -->
                                            <div class="mt-2">
                                                <span th:if="${content.file != null}" class="text-muted">
                                                    ÌòÑÏû¨ ÌååÏùº: <span th:text="${content.file?.fileName}"></span>
                                                </span>
                                                <span th:if="${content.file == null}" class="text-muted">
                                                    Îì±Î°ùÎêú ÌååÏùº ÏóÜÏùå
                                                </span>
                                            </div>
                                            <input type="file" class="form-control d-none content-file-input"
                                                   th:name="'file_' + ${content.lectureContentId}"
                                                   accept="${content.type === 'video' ? 'video/*' : '*'}">
                                        </div>
                                        <div class="ms-3">
                                            <button class="btn btn-primary btn-sm me-2 edit-content-btn"
                                                th:onclick="'toggleContentEdit(this, ' + ${content.lectureContentId} + ')'">ÏàòÏ†ï</button>
                                            <button class="btn btn-success btn-sm me-2 d-none save-content-btn"
                                                th:onclick="'saveContentEdit(this, ' + ${content.lectureContentId} + ')'">Ï†ÄÏû•</button>
                                            <button class="btn btn-danger btn-sm"
                                                th:onclick="'deleteContent(' + ${content.lectureContentId} + ')'">ÏÇ≠Ï†ú</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ÌÄ¥Ï¶à ÏÑπÏÖò -->
                            <div class="quiz-section mt-3" th:if="${lecture.quizzes != null && !lecture.quizzes.empty}">
                                <h5>ÌÄ¥Ï¶à</h5>
                                <div class="list-group">
                                    <div th:each="quiz : ${lecture.quizzes}" class="list-group-item"
                                        th:data-quiz-id="${quiz.quizId}">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1 quiz-question" th:text="${quiz.question}">ÌÄ¥Ï¶à Î¨∏Ï†ú</h6>
                                                <input type="text" class="form-control d-none quiz-question-input"
                                                    th:value="${quiz.question}">
                                                <p class="mb-1 quiz-answer" th:text="${quiz.answer}">ÌÄ¥Ï¶à ÎãµÏïà</p>
                                                <input type="text" class="form-control d-none quiz-answer-input"
                                                    th:value="${quiz.answer}">
                                            </div>
                                            <div class="ms-3">
                                                <button class="btn btn-primary btn-sm me-2 edit-quiz-btn"
                                                    th:onclick="'toggleQuizEdit(this, ' + ${quiz.quizId} + ', ' + ${lecture.lectureId} + ')'">ÏàòÏ†ï</button>
                                                <button class="btn btn-success btn-sm me-2 d-none save-quiz-btn"
                                                    th:onclick="'saveQuizEdit(this, ' + ${quiz.quizId} + ', ' + ${lecture.lectureId} + ')'">Ï†ÄÏû•</button>
                                                <button class="btn btn-danger btn-sm"
                                                    th:onclick="'deleteQuiz(' + ${quiz.quizId} + ')'">ÏÇ≠Ï†ú</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ÏΩòÌÖêÏ∏†/ÌÄ¥Ï¶à ÏóÜÏùÑ Îïå Î©îÏãúÏßÄ -->
                            <div th:if="${lecture.contents == null || lecture.contents.empty}"
                                class="text-center text-muted mt-3">
                                Îì±Î°ùÎêú ÏΩòÌÖêÏ∏†Í∞Ä ÏóÜÏäµÎãàÎã§.
                            </div>

                            <!-- Ï∂îÍ∞Ä Î≤ÑÌäºÎì§ -->
                            <div class="mt-3">
                                <button class="btn btn-success btn-sm me-2"
                                    th:onclick="'showAddContentForm(' + ${lecture.lectureId} + ')'">ÏΩòÌÖêÏ∏† Ï∂îÍ∞Ä</button>
                                <button class="btn btn-success btn-sm"
                                    th:onclick="'showAddQuizForm(' + ${lecture.lectureId} + ')'">ÌÄ¥Ï¶à Ï∂îÍ∞Ä</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="addSection()">ÏÑπÏÖò Ï∂îÍ∞Ä</button>
            <button class="btn btn-danger" onclick="deleteLecture()">Í∞ïÏ¢å ÏÇ≠Ï†ú</button>
        </div>
    </div>
    <div class="modal fade" id="addSectionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ÏÉà ÏÑπÏÖò Ï∂îÍ∞Ä</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addSectionForm">
                        <div class="mb-3">
                            <label class="form-label">ÏÑπÏÖò Ï†úÎ™©</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ÏÑπÏÖò ÏÑ§Î™Ö</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
                    <button type="button" class="btn btn-primary" onclick="submitAddSection()">Ï∂îÍ∞Ä</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editSectionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ÏÑπÏÖò ÏàòÏ†ï</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editSectionForm">
                        <input type="hidden" id="editSectionId">
                        <div class="mb-3">
                            <label class="form-label">ÏÑπÏÖò Ï†úÎ™©</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ÏÑπÏÖò ÏÑ§Î™Ö</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
                    <button type="button" class="btn btn-primary" onclick="submitEditSection()">Ï†ÄÏû•</button>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        // Í∞ïÏ¢å Ï†ïÎ≥¥ ÏàòÏ†ï
        async function updateCourseInfo() {
            const courseId = [[${ course.courseId }]];
            const form = document.getElementById('courseUpdateForm');
            const formData = new FormData(form);
            
            if (!formData.get('thumbnail').size) {
                formData.delete('thumbnail');
            }
            
            try {
                const response = await fetch(`/api/teacher/courses/${courseId}`, {
                    method: 'PUT',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Í∞ïÏ¢å Ï†ïÎ≥¥ ÏàòÏ†ï Ïã§Ìå®');
                }

                alert('Í∞ïÏ¢å Ï†ïÎ≥¥Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || 'Í∞ïÏ¢å Ï†ïÎ≥¥ ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        // ÏÑπÏÖò Í¥ÄÎ†® Ìï®ÏàòÎì§
        async function addSection() {
            const courseId = [[${ course.courseId }]];
            try {
                const response = await fetch(`/api/teacher/courses/${courseId}/lectures`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: 'ÏÉà ÏÑπÏÖò',
                        description: 'ÏÑπÏÖò ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî'
                    })
                });

                if (!response.ok) throw new Error('ÏÑπÏÖò Ï∂îÍ∞Ä Ïã§Ìå®');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ÏÑπÏÖò Ï∂îÍ∞ÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }
        // ÏÑπÏÖò ÏàòÏ†ï Î™®Îã¨ Ïó¥Í∏∞
        function editSection(button) {
            const container = button.closest('.accordion-body');
            const description = container.querySelector('.lecture-description');
            const lectureId = description.dataset.lectureId;
            const title = description.dataset.lectureTitle;
            const descriptionText = description.dataset.lectureDescription;

            const modal = new bootstrap.Modal(document.getElementById('editSectionModal'));
            document.getElementById('editSectionId').value = lectureId;
            document.querySelector('#editSectionForm [name="title"]').value = title;
            document.querySelector('#editSectionForm [name="description"]').value = descriptionText;
            modal.show();
        }

        // ÏÑπÏÖò ÏàòÏ†ï Ï†úÏ∂ú
        async function submitEditSection() {
            const form = document.getElementById('editSectionForm');
            const lectureId = document.getElementById('editSectionId').value;
            const formData = new FormData(form);

            try {
                const response = await fetch(`/api/teacher/lectures/${lectureId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: formData.get('title'),
                        description: formData.get('description')
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ÏÑπÏÖò ÏàòÏ†ï Ïã§Ìå®');
                }

                alert('ÏÑπÏÖòÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || 'ÏÑπÏÖò ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        async function deleteSection(lectureId) {
            if (!confirm('Ï†ïÎßê Ïù¥ ÏÑπÏÖòÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                const response = await fetch(`/api/teacher/lectures/${lectureId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('ÏÑπÏÖò ÏÇ≠Ï†ú Ïã§Ìå®');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ÏÑπÏÖò ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        async function deleteContent(contentId) {
            if (!confirm('Ï†ïÎßê Ïù¥ ÏΩòÌÖêÏ∏†Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                const response = await fetch(`/api/teacher/contents/${contentId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('ÏΩòÌÖêÏ∏† ÏÇ≠Ï†ú Ïã§Ìå®');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(`ÏΩòÌÖêÏ∏† ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. : ${error.message}`);
            }
        }

        async function showAddContentForm(lectureId) {
            const contentList = document.querySelector(`#lecture${lectureId} .list-group`);
            const formHtml = `
        <div class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
                <div class="flex-grow-1">
                    <input type="text" class="form-control mb-2" name="title" required placeholder="ÏΩòÌÖêÏ∏† Ï†úÎ™©">
                    <textarea class="form-control mb-2" name="description" rows="2" required placeholder="ÏΩòÌÖêÏ∏† ÏÑ§Î™Ö"></textarea>
                    <select class="form-control mb-2" name="type" required>
                        <option value="video">ÎèôÏòÅÏÉÅ</option>
                        <option value="file">Î¨∏ÏÑú</option>
                    </select>
                    <input type="file" class="form-control" name="file" required>
                </div>
                <div class="ms-3">
                    <button class="btn btn-primary btn-sm mb-2" onclick="createContent(${lectureId}, this.closest('.list-group-item'))">Ï†ÄÏû•</button>
                    <button class="btn btn-secondary btn-sm" onclick="this.closest('.list-group-item').remove()">Ï∑®ÏÜå</button>
                </div>
            </div>
        </div>
    `;
            contentList.insertAdjacentHTML('beforeend', formHtml);
        }
        async function createContent(lectureId, formElement) {
            const formData = new FormData();
            formData.append('lectureId', lectureId);
            formData.append('title', formElement.querySelector('[name="title"]').value);
            formData.append('description', formElement.querySelector('[name="description"]').value);
            formData.append('type', formElement.querySelector('[name="type"]').value);
            formData.append('file', formElement.querySelector('[name="file"]').files[0]);
            try {
                const response = await fetch(`/api/teacher/lectures/${lectureId}/contents`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('ÏΩòÌÖêÏ∏† Ï∂îÍ∞Ä Ïã§Ìå®');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ÏΩòÌÖêÏ∏† Ï∂îÍ∞ÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }
        async function showAddQuizForm(lectureId) {
            const quizList = document.querySelector(`#lecture${lectureId} .quiz-list`);
            if (!quizList) {
                // ÌÄ¥Ï¶à Î¶¨Ïä§Ìä∏Í∞Ä ÏóÜÏúºÎ©¥ ÏÉùÏÑ±
                const accordionBody = document.querySelector(`#lecture${lectureId} .accordion-body`);
                const quizSection = document.createElement('div');
                quizSection.className = 'quiz-section mt-3';
                quizSection.innerHTML = '<h5>ÌÄ¥Ï¶à</h5><div class="quiz-list"></div>';
                accordionBody.appendChild(quizSection);
            }

            const formHtml = `
        <div class="quiz-item card mb-2">
            <div class="card-body">
                <div class="mb-2">
                    <input type="text" class="form-control" name="question" placeholder="Î¨∏Ï†ú">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" name="answer" placeholder="Ï†ïÎãµ">
                </div>
                <div class="d-flex justify-content-end">
                    <button class="btn btn-primary btn-sm me-2" onclick="createQuiz(${lectureId}, this.closest('.quiz-item'))">Ï†ÄÏû•</button>
                    <button class="btn btn-secondary btn-sm" onclick="this.closest('.quiz-item').remove()">Ï∑®ÏÜå</button>
                </div>
            </div>
        </div>
    `;

            document.querySelector(`#lecture${lectureId} .quiz-list`).insertAdjacentHTML('beforeend', formHtml);
        }

        async function createQuiz(lectureId, quizItem) {
            const question = quizItem.querySelector('[name="question"]').value;
            const answer = quizItem.querySelector('[name="answer"]').value;

            if (!question || !answer) {
                alert('Î¨∏Ï†úÏôÄ Ï†ïÎãµÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch(`/api/teacher/lectures/${lectureId}/quizzes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        lectureId: lectureId,
                        quizzes: [{
                            question: question,
                            answer: answer
                        }]
                    })
                });

                if (!response.ok) throw new Error('ÌÄ¥Ï¶à Ï∂îÍ∞Ä Ïã§Ìå®');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ÌÄ¥Ï¶à Ï∂îÍ∞ÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        //ÌÄ¥Ï¶à ÏÇ≠Ï†ú
        async function deleteQuiz(quizId) {
            if (!confirm('Ï†ïÎßê Ïù¥ ÌÄ¥Ï¶àÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                const response = await fetch(`/api/teacher/quizzes/${quizId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('ÌÄ¥Ï¶à ÏÇ≠Ï†ú Ïã§Ìå®');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ÌÄ¥Ï¶à ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        // ÏΩòÌÖêÏ∏† ÏàòÏ†ï ÌÜ†Í∏Ä
        function toggleContentEdit(btn, contentId) {
            const contentItem = btn.closest('[data-content-id]');
            const titleSpan = contentItem.querySelector('.content-title');
            const titleInput = contentItem.querySelector('.content-title-input');
            const descSpan = contentItem.querySelector('.content-description');
            const descInput = contentItem.querySelector('.content-description-input');
            const editBtn = contentItem.querySelector('.edit-content-btn');
            const saveBtn = contentItem.querySelector('.save-content-btn');
            const fileInput = contentItem.querySelector('.content-file-input');

            titleSpan.classList.toggle('d-none');
            titleInput.classList.toggle('d-none');
            descSpan.classList.toggle('d-none');
            descInput.classList.toggle('d-none');
            editBtn.classList.toggle('d-none');
            saveBtn.classList.toggle('d-none');
            fileInput.classList.toggle('d-none');
        }

        // ÏΩòÌÖêÏ∏† ÏàòÏ†ï Ï†ÄÏû•
        async function saveContentEdit(btn, contentId) {
            const contentItem = btn.closest('[data-content-id]');
            const formData = new FormData();
            formData.append('title', contentItem.querySelector('.content-title-input').value);
            formData.append('description', contentItem.querySelector('.content-description-input').value);
            const fileInput = contentItem.querySelector('.content-file-input');
            if (fileInput.files.length > 0) {
                formData.append('file', fileInput.files[0]);
            }
            try {
                const response = await fetch(`/api/teacher/contents/${contentId}`, {
                    method: 'PUT',
                    body: formData
                });

                if (!response.ok) throw new Error('ÏΩòÌÖêÏ∏† ÏàòÏ†ï Ïã§Ìå®');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('ÏΩòÌÖêÏ∏† ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        // ÌÄ¥Ï¶à ÏàòÏ†ï ÌÜ†Í∏Ä
        function toggleQuizEdit(btn, quizId, lectureId) {
            const quizItem = btn.closest('[data-quiz-id]');
            const questionSpan = quizItem.querySelector('.quiz-question');
            const questionInput = quizItem.querySelector('.quiz-question-input');
            const answerSpan = quizItem.querySelector('.quiz-answer');
            const answerInput = quizItem.querySelector('.quiz-answer-input');
            const editBtn = quizItem.querySelector('.edit-quiz-btn');
            const saveBtn = quizItem.querySelector('.save-quiz-btn');

            questionSpan.classList.toggle('d-none');
            questionInput.classList.toggle('d-none');
            answerSpan.classList.toggle('d-none');
            answerInput.classList.toggle('d-none');
            editBtn.classList.toggle('d-none');
            saveBtn.classList.toggle('d-none');
        }

        // ÌÄ¥Ï¶à ÏàòÏ†ï Ï†ÄÏû•
        async function saveQuizEdit(btn, quizId, lectureId) {
            const quizItem = btn.closest('[data-quiz-id]');
            const quizData = {
                question: quizItem.querySelector('.quiz-question-input').value,
                answer: quizItem.querySelector('.quiz-answer-input').value
            };

            try {
                const response = await fetch(`/api/teacher/quizzes/${quizId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(quizData)
                });

                if (!response.ok) throw new Error('ÌÄ¥Ï¶à ÏàòÏ†ï Ïã§Ìå®');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(`ÌÄ¥Ï¶à ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. : ${error.message}`);
            }
        }

        // ÏÑπÏÖò Ï∂îÍ∞Ä Î™®Îã¨ Ïó¥Í∏∞
        function addSection() {
            new bootstrap.Modal(document.getElementById('addSectionModal')).show();
        }

        // ÏÑπÏÖò Ï∂îÍ∞Ä Ï†úÏ∂ú
        async function submitAddSection() {
            const courseId = [[${ course.courseId }]];
            const form = document.getElementById('addSectionForm');
            const formData = new FormData(form);

            try {
                const response = await fetch(`/api/teacher/courses/${courseId}/lectures`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: formData.get('title'),
                        description: formData.get('description')
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ÏÑπÏÖò Ï∂îÍ∞Ä Ïã§Ìå®');
                }

                alert('ÏÑπÏÖòÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.');
                location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || 'ÏÑπÏÖò Ï∂îÍ∞ÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }
        async function deleteLecture() {
            const courseId = [[${ course.courseId }]];
            if (!confirm('Ï†ïÎßê Ïù¥ Í∞ïÏùòÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            try {
                const response = await fetch(`/api/teacher/courses/${courseId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    alert('Í∞ïÏùòÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    location.href = '/teacher/myLectures';
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Í∞ïÏùò ÏÇ≠Ï†ú Ïã§Ìå®');
                }
            } catch (error) {
                alert(`Í∞ïÏùò ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. : ${error.message}`);
            }
        }
    </script>
    <footer th:replace="~{teacher/common/footer :: footer}"></footer>
</body>

</html>